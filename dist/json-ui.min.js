/* 2015-09-17 03:55 */
angular.module("jcab.json-ui",["ui.tinymce"]),angular.module("jcab.json-ui").directive("jsonAddValue",function(){return{restrict:"A",templateUrl:"json-ui/add-value.tpl.html",link:function(a){a.propType="string",a.addProp=function(b){if(!a.propName)return void alert("Ce champ a besoin d'un nom");if(a.objData.hasOwnProperty(a.propName))return void alert("Ce nom existe déjà");var c;switch(b){case"string":c="";break;case"number":c=0;break;case"bool":c=!0;break;case"array":c=[];break;case"object":c={}}a.objData[a.propName]=c,a.propName=""}}}}),angular.module("jcab.json-ui").directive("jsonArray",function(){return{restrict:"A",scope:{objData:"=jsonArray"},templateUrl:"json-ui/array.tpl.html",link:function(a){a.add=function(){a.objData.push(_.cloneDeep(_.last(a.objData)))}}}}),angular.module("jcab.json-ui").directive("jsonAutoGrow",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){var b=a.pageYOffset,c=a.pageXOffset,e="100%";d.val().length<=10?e="126px":d.val().length<=30?e="320px":d.val().length<=50&&(e="510px"),d.css({width:e,height:"auto",overflow:"hidden"});var f=d[0].scrollHeight;f>0&&d.css("height",f+"px"),a.scrollTo(c,b)}d.on("input propertychange",f),b(f),e.ngModel&&c.$watch(e.ngModel,f)}}}]),angular.module("jcab.json-ui").directive("jsonEditor",function(){return{restrict:"A",scope:!0,templateUrl:"json-ui/editor.tpl.html",link:function(a,b,c){a.$watch(c.jsonEditor,function(b){a.data=b})}}}),angular.module("jcab.json-ui").directive("jsonNumber",function(){return{restrict:"A",templateUrl:"json-ui/number.tpl.html",link:function(a){var b="objData[key]";a.$watch(b,function(b){a.strData=b}),a.$watch("strData",function(c){_.isNaN(1*c)||""===c?a.$eval(b+'="'+c.replace(/"/gi,'\\"')+'"'):(c=1*c,a.$eval(b+"="+c))})}}}),angular.module("jcab.json-ui").directive("jsonObject",function(){return{restrict:"A",scope:{objData:"=jsonObject"},templateUrl:"json-ui/object.tpl.html"}}),angular.module("jcab.json-ui").directive("jsonPushValue",function(){return{restrict:"A",templateUrl:"json-ui/push-value.tpl.html",link:function(a){a.propType="",a.pushLastClone=function(){a.objData.push(angular.copy(a.objData[a.objData.length-1]))},a.pushValue=function(b){if(!b)return void alert("Type inconnu");var c;switch(b){case"string":c="";break;case"number":c=0;break;case"bool":c=!0;break;case"array":c=[];break;case"object":c={}}a.objData.push(c),a.propType=""}}}}),angular.module("jcab.json-ui").factory("recursiveDirectiveHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("jcab.json-ui").directive("jsonRteValue",function(){return{restrict:"A",templateUrl:"json-ui/rte-value.tpl.html"}}),angular.module("jcab.json-ui").directive("jsonString",function(){return{restrict:"A",templateUrl:"json-ui/string.tpl.html",link:function(a){a.isRTEOpened=!1,a.openRTE=function(){a.isRTEOpened=!0},a.closeRTE=function(){a.isRTEOpened=!1},a.tinymceOptions={inline:!1,menu:!1,menubar:!1,min_height:300,plugins:"autolink link lists preview",skin:"lightgray",theme:"modern",content_style:['#tinymce { font-size: 20px; line-height: 1.4; font-family: font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;}',"#tinymce p, #tinymce div { margin: 1em 0; }"].join(""),forced_root_block:"",onChange:function(a){console.log("e: ",a)}},a.$watch("objData[key]",function(b){a.tinymceOptions.forced_root_block=b.match(/<p/gi)?"p":b.match(/<div/gi)?"div":""})}}}),angular.module("jcab.json-ui").directive("jsonValue",["recursiveDirectiveHelper",function(a){return{restrict:"A",scope:!0,templateUrl:"json-ui/value.tpl.html",compile:function(b){return a.compile(b,function(a,b,c){a.$watch(c.jsonValue,function(b){a.data=b}),a.isObject=_.isPlainObject,a.isArray=_.isArray,a.isString=_.isString,a.isNumber=_.isNumber})}}}]),angular.module("jcab.json-ui").run(["$templateCache",function(a){"use strict";a.put("json-ui/add-value.tpl.html",'<form ng-submit="addProp(propType)" class="form-inline text-right"><input ng-model="propName" class="form-control form-control-sm" placeholder="nom du champ" style="width: 240px"><select ng-model="propType" class="form-control"><option value="string">Texte</option><option value="number">Nombre</option><option value="bool">Booléen</option><option value="array">Tableau</option><option value="object">Objet</option></select><button type="submit" class="invisible">ok</button></form>'),a.put("json-ui/array.tpl.html",'<table class="table table-bordered"><tr ng-repeat="(key, value) in objData track by $index"><td valign="top" class="json-label">{{ key }}:</td><td valign="top" class="json-value" json-value="value"></td></tr><tr><td colspan="2" class="json-add-value text-right" json-push-value></td></tr></table>'),a.put("json-ui/editor.tpl.html",'<div class="json-ui" json-value="data"></div>'),a.put("json-ui/number.tpl.html",'<span class="json-field json-number"><input type="number" ng-model="strData" class="form-control"></span>'),a.put("json-ui/object.tpl.html",'<table class="table table-bordered"><tr ng-repeat="(key, value) in objData"><td valign="top" class="json-label"><span>{{ key }}:</span></td><td valign="top" class="json-value"><span json-value="value"></span></td></tr><tr><td colspan="2" class="json-add-value text-right" json-add-value></td></tr></table>'),a.put("json-ui/push-value.tpl.html",'<form ng-submit="pushValue(propType)" class="form-inline text-right"><select ng-model="propType" class="form-control" ng-change="pushValue(propType)"><option value="">Ajouter</option><option value="string">Texte</option><option value="number">Nombre</option><option value="bool">Booléen</option><option value="array">Tableau</option><option value="object">Objet</option></select><span ng-if="objData.length > 0" style="color: white">ou <button type="button" ng-click="pushLastClone()" class="btn btn-secondary btn-sm">dupliquer le dernier élément</button></span> <button type="submit" class="invisible">ok</button></form>'),a.put("json-ui/rte-value.tpl.html",'<div class="modal-backdrop fade in" style="display: block"></div><div class="modal fade in" style="display: block"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button ng-click="closeRTE()" type="button" class="close" data-dismiss="modal" aria-label="Fermer"><span aria-hidden="true">&times;</span> <span class="sr-only">Fermer</span></button><h4 class="modal-tit">{{ key }}</h4></div><div class="modal-body"><textarea ui-tinymce="tinymceOptions" ng-model="objData[key]"></textarea></div><div class="modal-footer"><button ng-click="closeRTE()" type="button" class="btn btn-primary">Enregistrer</button></div></div></div></div>'),a.put("json-ui/string.tpl.html",'<span class="json-field json-string"><textarea ng-model="objData[key]" ng-dblclick="openRTE()" json-auto-grow rows="1" cols="50" class="form-control"></textarea></span><div ng-if="isRTEOpened" json-rte-value></div>'),a.put("json-ui/value.tpl.html",'<span ng-if="isString(data)" json-string="data"></span> <span ng-if="isNumber(data)" json-number="data"></span> <span ng-if="isArray(data)" json-array="data"></span> <span ng-if="isObject(data)" json-object="data"></span>')}]);